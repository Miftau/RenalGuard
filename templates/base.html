<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ title or "RenalGuard" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- AOS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

  <!-- Favicon - Updated to a potential kidney icon -->
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3157/3157715.png"> <!-- Example kidney icon -->

  <!-- Preload heartbeat sound (optional) -->
  <link rel="preload" href="https://assets.mixkit.co/sfx/preview/mixkit-heartbeat-747.mp3" as="audio">

  <!-- ---------------------------------------------------- -->
  <!--  DARK MODE & NAVBAR JS (only one copy)               -->
  <!-- ---------------------------------------------------- -->
  <script>
    // ---- 1. Dark-mode init -------------------------------------------------
    document.addEventListener('DOMContentLoaded', () => {
      const html = document.documentElement;
      const toggle = document.getElementById('dark-mode-toggle');
      const sun = document.getElementById('dark-mode-sun'); // Target specific IDs
      const moon = document.getElementById('dark-mode-moon');

      if (!toggle) {
          console.error("Dark mode toggle button not found!");
          return;
      }

      // Apply saved preference or system preference
      const saved = localStorage.getItem('darkMode');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = saved === 'dark' || (!saved && prefersDark);

      if (isDark) {
        html.classList.add('dark');
        if (sun) sun.classList.add('hidden');
        if (moon) moon.classList.remove('hidden');
      } else {
        if (sun) sun.classList.remove('hidden');
        if (moon) moon.classList.add('hidden');
      }

      // Toggle handler
      toggle.addEventListener('click', () => {
        html.classList.toggle('dark');
        const isCurrentlyDark = html.classList.contains('dark');
        localStorage.setItem('darkMode', isCurrentlyDark ? 'dark' : 'light');
        if (sun) {
          sun.classList.toggle('hidden', isCurrentlyDark);
        }
        if (moon) {
          moon.classList.toggle('hidden', !isCurrentlyDark);
        }
      });

      // ---- 2. Navbar --------------------------------------------------------
      const menu = document.getElementById('mobile-menu');
      const btn  = document.getElementById('mobile-menu-toggle');
      const icon = document.getElementById('menu-icon');

      if (!menu || !btn || !icon) {
          console.warn("Mobile menu elements not found, skipping mobile menu setup.");
          return; // Exit if mobile menu elements are missing
      }

      // Show/hide based on breakpoint
      const handleResize = () => {
        if (window.innerWidth >= 640) {                 // sm: breakpoint
          menu.classList.remove('hidden');
          btn.classList.add('hidden');
          icon.classList.remove('fa-times'); icon.classList.add('fa-bars');
        } else {
          menu.classList.add('hidden');
          btn.classList.remove('hidden');
        }
      };
      handleResize();
      window.addEventListener('resize', handleResize);

      // Toggle on button click
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('hidden');
        icon.classList.toggle('fa-bars');
        icon.classList.toggle('fa-times');
      });

      // Close when clicking outside
      document.addEventListener('click', (e) => {
        if (!menu.classList.contains('hidden') &&
            !menu.contains(e.target) &&
            !btn.contains(e.target)) {
          menu.classList.add('hidden');
          icon.classList.remove('fa-times'); icon.classList.add('fa-bars');
        }
      });

      // ---- 3. AOS init ------------------------------------------------------
      AOS.init({ once: true, duration: 800, easing: 'ease-out-cubic' });
    });
  </script>

  <!-- ---------------------------------------------------- -->
  <!--  STYLES (dark-mode, animations, mobile menu)        -->
  <!-- ---------------------------------------------------- -->
  <style>
    /* Dark-mode basics */
    .dark { @apply bg-gray-900 text-gray-100; }
    .dark .bg-white { @apply bg-gray-800; }
    .dark .text-gray-800 { @apply text-gray-200; }
    .dark .bg-gray-50 { @apply bg-gray-900; }
    .dark .shadow-lg { @apply shadow-gray-700; }
    .dark .border-gray-800 { @apply border-gray-700; }
    .dark .bg-gray-900 { @apply bg-gray-900; } /* Ensure bg-gray-900 is distinct in dark mode */
    /* Ensure sticky navbar has high z-index */
    .sticky-nav { z-index: 9999; }

    /* Hide when Alpine would use x-cloak */
    [x-cloak] { display: none !important; }

    html, body { overflow-x: hidden; }

    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fade-in 1s ease-out forwards; }

    @keyframes pulse-kidney {
      0%,100% { transform: scale(1); }
      50%     { transform: scale(1.15); }
    }
    .animate-pulse-kidney { animation: pulse-kidney 2s infinite ease-in-out; } /* Updated animation name */

    /* Mobile menu slide-down */
    #mobile-menu {
      transition: max-height .3s ease, padding .3s ease;
      max-height: 0;
      overflow: hidden;
      background: inherit;
    }
    #mobile-menu:not(.hidden) {
      max-height: 600px;   /* enough for all items */
      padding: 1rem 0;
      background: white;
      @apply dark:bg-gray-800; /* Apply dark mode bg to menu */
    }
    @media (min-width: 640px) {
      #mobile-menu { max-height: none !important; padding: 0 !important; }
    }

    /* Active link highlight */
    .nav-active {
      @apply text-blue-500 font-semibold; /* Changed color */
    }
    .dark .nav-active { @apply text-blue-400; } /* Changed color */
  </style>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col transition-colors duration-300">
  <!-- ==================== NAVBAR ==================== -->
  <!-- Ensure the navbar container is relative to the document flow -->
  <nav class="bg-white shadow-lg py-4 sticky top-0 z-50 transition-all duration-300 sticky-nav">
    <div class="container mx-auto flex justify-between items-center px-4 sm:px-6">

      <!-- Logo -->
      <a href="/" class="text-2xl sm:text-4xl font-bold text-blue-500 flex items-center"> <!-- Changed color -->
        <span class="mr-2 animate-pulse-kidney">ðŸ«˜</span> RenalGuard <!-- Updated emoji and text -->
      </a>

      <!-- Dark-mode toggle (visible on all sizes) -->
      <button id="dark-mode-toggle"
              class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
              aria-label="Toggle dark mode">
        <i id="dark-mode-sun" class="fas fa-sun text-yellow-500 text-xl"></i>
        <i id="dark-mode-moon" class="fas fa-moon hidden text-indigo-400 text-xl"></i>
      </button>

      <!-- Mobile hamburger (sm:hidden) -->
      <button id="mobile-menu-toggle"
              class="sm:hidden text-gray-700 focus:outline-none z-50"
              aria-label="Toggle menu">
        <i id="menu-icon" class="fas fa-bars text-2xl transition-transform duration-300"></i>
      </button>

      <!-- Navigation links -->
      <ul id="mobile-menu"
          class="hidden flex-col w-full mt-4 space-y-4 text-gray-700 bg-white absolute top-full left-0 shadow-lg sm:shadow-none sm:flex sm:flex-row sm:space-x-6 sm:w-auto sm:mt-0 sm:space-y-0 sm:bg-transparent sm:static sm:block">

        {% macro nav_item(url, label, is_external=false) %}
          <li>
            <a href="{{ url }}"
            {% if is_external %}target="_blank" rel="noopener noreferrer"{% endif %}
               class="block hover:text-blue-500 text-lg sm:text-xl transition-all duration-300 px-4 py-2 sm:p-0 <!-- Changed color -->
                      {% if request.path == url %}nav-active{% endif %}">
              {{ label }}
            </a>
          </li>
        {% endmacro %}

        {{ nav_item('/', 'Home') }}
        {{ nav_item('https://cardioguard-u3g4.onrender.com/about', 'About', is_external=true) }} <!-- Example External Link -->
        {{ nav_item('https://cardioguard-u3g4.onrender.com/contact', 'Contact', is_external=true) }} <!-- Example External Link -->
        {{ nav_item('/resources', 'Resources') }} <!-- Example External Link -->
        {{ nav_item('/chat', 'RenalConsultant') }}
         <!-- Login / Logout logic -->
        {% if session.get('user_id') %}
          <li>
            <a href="/logout"
               class="block bg-gray-800 text-white px-4 py-2 rounded-full hover:bg-gray-900 hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-md sm:text-lg text-center font-semibold mx-4 sm:mx-0">
              Logout
            </a>
          </li>
        {% else %}
          <li>
            <a href="/login"
               class="block bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 hover:shadow-xl transform hover:scale-105 transition-all duration-300 text-md sm:text-lg text-center font-semibold mx-4 sm:mx-0"> <!-- Changed color -->
              Login
            </a>
          </li>
        {% endif %}
      </ul>
    </div>
  </nav>

  <!-- ==================== MAIN CONTENT ==================== -->
  <!-- Ensure main content starts below the fixed/sticky navbar -->
  <main class="flex-1 container mx-auto p-4 sm:p-6">
    <div data-aos="fade-up">
      {% block content %}{% endblock %}
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-300 mt-auto">
    <div class="container mx-auto px-4 py-8 sm:py-12">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">

        <!-- Column 1 -->
        <div data-aos="fade-right" data-aos-delay="100">
          <h3 class="text-lg sm:text-xl font-bold text-white mb-4 flex items-center">
            <span class="mr-2 animate-pulse-kidney">ðŸ«˜</span> RenalGuard <!-- Updated emoji and text -->
          </h3>
          <p class="mb-4 text-base leading-relaxed">
            RenalGuard is an AI-powered diagnostic tool designed to help healthcare professionals and individuals assess the likelihood of kidney disease. By combining clinical parameters and data science, it delivers fast, data-driven insights.
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-white transform hover:scale-125 transition-all duration-300"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="text-gray-400 hover:text-white transform hover:scale-125 transition-all duration-300"><i class="fab fa-twitter"></i></a>
            <a href="#" class="text-gray-400 hover:text-white transform hover:scale-125 transition-all duration-300"><i class="fab fa-instagram"></i></a>
            <a href="#" class="text-gray-400 hover:text-white transform hover:scale-125 transition-all duration-300"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>

        <!-- Column 2 -->
        <div data-aos="fade-up" data-aos-delay="200">
          <h3 class="text-lg font-semibold text-white mb-4">Quick Links</h3>
          <ul class="space-y-2 text-base">
            {% for link, text in [('/', 'Home'), ('https://cardioguard-u3g4.onrender.com/about', 'About Us'), ('https://cardioguard-u3g4.onrender.com/contact', 'Contact'), ('/resources', 'Resources')] %} 
            <li>
              <a href="{{ link }}" class="hover:text-white transition-all duration-300 flex items-center group">
                <span class="inline-block w-0 group-hover:w-3 transition-all duration-300">â†’</span> {{ text }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>

        <!-- Column 3 -->
        <div data-aos="fade-up" data-aos-delay="300">
          <h3 class="text-lg font-semibold text-white mb-4">Services</h3>
          <ul class="space-y-2 text-base">
            <li><a href="#" class="hover:text-white transition-all duration-300">Remote Patient Monitoring</a></li>
            <li><a href="#" class="hover:text-white transition-all duration-300">TeleNephrology Consultations</a></li> <!-- Updated service -->
            <li><a href="#" class="hover:text-white transition-all duration-300">Dietary Prescription (Kidney-Friendly)</a></li> <!-- Updated service -->
            <li><a href="#" class="hover:text-white transition-all duration-300">AI Exercise Partner</a></li>
            <li><a href="#" class="hover:text-white transition-all duration-300">HealthTech</a></li>
          </ul>
        </div>

        <!-- Column 4 -->
        <div data-aos="fade-left" data-aos-delay="400">
          <h3 class="text-lg font-semibold text-white mb-4">Contact Us</h3>
          <ul class="space-y-3 text-base">
            <li class="flex items-start hover:text-white transition-all duration-300">
              <i class="fas fa-map-marker-alt mt-1 mr-3 text-blue-500"></i> <!-- Changed color -->
              <span>BLK 4 Railway Compound, Ibadan.</span>
            </li>
            <li class="flex items-center hover:text-white transition-all duration-300">
              <i class="fas fa-phone mr-3 text-blue-500"></i> <!-- Changed color -->
              <a href="tel:+2348066127153" class="hover:underline">+234 8066127153</a>
            </li>
            <li class="flex items-center hover:text-white transition-all duration-300">
              <i class="fas fa-envelope mr-3 text-blue-500"></i> <!-- Changed color -->
              <a href="mailto:muftaudeenyusufbabatunde@gmail.com" class="hover:underline break-all">muftaudeenyusufbabatunde@gmail.com</a>
            </li>
            <li class="flex items-center hover:text-white transition-all duration-300">
              <i class="fas fa-clock mr-3 text-blue-500"></i> <!-- Changed color -->
              <span>Monâ€“Fri: 9AM â€“ 10PM</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-800 mt-12 pt-8 text-center text-base animate-fade-in">
        <p>&copy; 2025 RenalGuard. Built with <span class="text-blue-500">ðŸ’™</span> by Team VitalGuide of PROGRESS ICT MEDIA CONCEPTS LTD.</p> <!-- Updated name and heart color -->
      </div>
    </div>
  </footer>

</body>
</html>